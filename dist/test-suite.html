<html><head><meta charset="UTF-8"><template id="test-suite">
  <style scoped="">
    .suite {
      width: 100%;
      margin-bottom: 10px;
    }
    .suite-title {
      font-size: 1.25em;
    }
    .suite-code {
      background: rgba(0,0,0,0.6);
      color: #EEE;
      margin: 6px -0.5em;
    }
    .suite-code > div {
      padding: 6px 0.5em;
      text-align: center;
    }
    img {
      height: 2.25em;
      margin-bottom: -0.75em;
    }
  </style>
  <div class="suite">
    <div class="suite-title"></div>
    <div class="active-tests"></div>
    <button class="add-test" onclick="createTest(testSuite.suite);">Create New Test</button>
    <div class="suite-code"></div>
  </div>
</template>

<script>
  var testSuite = (function() {
    'use strict';
    var importDoc = document.currentScript.ownerDocument;
    var proto = Object.create(HTMLElement.prototype);

    proto.createdCallback = function() {
      var template = importDoc.querySelector('#test-suite');
      var clone = document.importNode(template.content, true);
      var root = this.createShadowRoot();
      root.appendChild(clone);
    };

    proto.attachedCallback = function() {
      // var suiteName = this.suite.name;
      // var suiteCode = this.suite.code || false;
      var suiteName = this.getAttribute('name');
      var suiteCode = this.code; // TODO: might work... better than an attribute.

      // exports.suite = this.suite;

      var suite = this.shadowRoot.querySelector('.suite');
      var sc = this.shadowRoot.querySelector('.suite-code');
      this.shadowRoot.querySelector('.suite-title').innerHTML = suiteName + " Tests";
// 

      // move to attribute change
      function displayCode() {
        sc.innerHTML = "<div>" + suiteName + " Code: " + suiteCode + "</div>";
      };

      // var numberOfMandatoryTests = 0;
      // var eventCollector = [];
      // this.addEventListener('test-status', function (e) {
      //   // e.detail includes index, testCorrect, testDesc
      //   eventCollector[e.detail.index] = e.detail;
      //   if (eventCollector.length === numberOfMandatoryTests) {
      //     var allTestsPassed = eventCollector.every(function(val, index, arr) {
      //       return val.testCorrect;
      //     })
      //     if (allTestsPassed) {
      //       var passEvent = new CustomEvent('suite-passed', {'detail': suiteName});
      //       suite.dispatchEvent(passEvent);
      //       if (suiteCode) {
      //         displayCode();
      //       }
      //     }
      //   }
      // });

      // function createTestElement(newTest) {
      //   var activeTest = document.createElement('active-test');
      //   var activeTests = suite.querySelector('.active-tests');
      //   // activeTest.testDefinition = newTest;
      //   activeTest.setAttribute('description', newTest.description);
      //   activeTest.setAttribute('testPassed', newTest.testPassed);

      //   activeTests.appendChild(activeTest);
      // }
      // TODO: CAN I EXPORT THIS FUNCTION???????
      // this.createTestElement = createTestElement;

      // this.suite.tests.forEach(function(test, index, arr) {
      //   test.index = index;
      //   createTest(test);
      // })

      // Array.observe(this.suite.tests, function(change) {
      //   if (change[0].type === 'splice') {
      //     createTest(change[0].object[0]);
      //   }
      // })
      return this;
    };

    document.registerElement('test-suite', {prototype: proto});
    // return createTest;
  })();
  function createTest(suite) {
    // console.log(suite);

    testWidget.editTest(null, suite);
  };
</script></head><body></body></html>