<!--
This component (<test-results>) describes the suite editor view.
-->

<template id="test-results">
  <style scoped>
    .toggle_display {
      display: inline;
      height: 2em;
    }

    .hide {
      display: none;
    }

    button.shown::before {
      content: "Hide";
    }

    button.hidden::before {
      content: "Show";
    }

    button.add-suite {
      display: block;
    }
  </style>
  <div class="test-results">
    <button class="toggle_display shown"> Test Results</button>
    <div class="test-suites"></div>
    <button class="add-suite" onclick="testWidget.editSuite()">Add Suite</button>
  </div>
</template>

<script>
  var testResults = (function() {
    'use strict';
    var exports = {};
    var buildSuiteElement = function() {};
    var importDoc = document.currentScript.ownerDocument; // importee

    // Define and register <test-widget>
    // that uses Shadow DOM and a template.
    var proto = Object.create(HTMLElement.prototype);

    proto.createdCallback = function() {
      // get template in import
      var template = importDoc.querySelector('#test-results');

      // import template into
      var clone = document.importNode(template.content, true);

      var root = this.createShadowRoot();
      root.appendChild(clone);
    };

    proto.attachedCallback = function() {
      var testSuites = this.shadowRoot.querySelector('.test-suites');

      // TODO: would love to move this to hotel at some point
      var buildSuiteElement = function (newSuite) {
        var _testSuite = document.createElement('test-suite');

        _testSuite.setAttribute('name', newSuite.name);
        _testSuite.setAttribute('suite-passed', false);
        _testSuite.code = newSuite.code;  // to avoid leaving the code as an easy-to-spot attribute

        _testSuite.suite = newSuite;

        _testSuite.createTest = function (_test) {
          // TODO: actually collect this from the DOM
          newSuite.createTest({
            description: _test.description,
            activeTest: _test.activeTest,
            flags: _test.flags || []
          })
        }

        testSuites.appendChild(_testSuite);

        return _testSuite;
      }
      exports.buildSuiteElement = buildSuiteElement;

      var testResults = this.shadowRoot.querySelector('.test-results');
      var toggleDisplayElem = testResults.querySelector('.toggle_display');
      
      toggleDisplayElem.onclick = function() {
        testResults.querySelector('.test-suites').classList.toggle('hide');
        testResults.querySelector('.toggle_display').classList.toggle('hidden');
        testResults.querySelector('.toggle_display').classList.toggle('shown');
      }
    };

    document.registerElement('test-results', {prototype: proto});
    return exports;
  })();
</script>